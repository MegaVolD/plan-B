<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –ª–µ–∫–∞—Ä—Å—Ç–≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .medication-card {
            border-left: 4px solid #007bff;
            transition: transform 0.2s;
        }
        .medication-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .today-card {
            background-color: #e8f5e8;
            border-left: 4px solid #28a745;
        }
        .status-taken {
            color: #28a745;
            font-weight: bold;
        }
        .status-pending {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" href="/">üíä –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–∏—ë–º–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤</a>
        <div class="navbar-nav">
            <a class="nav-link" href="/api/medications" target="_blank">REST API</a>
            <a class="nav-link" href="/h2-console" target="_blank">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <!-- –ü–æ–∏—Å–∫ -->
    <div class="row mb-4">
        <div class="col-md-6">
            <form th:action="@{/medications/search}" method="get" class="d-flex">
                <input type="text" name="query" class="form-control me-2" placeholder="–ü–æ–∏—Å–∫ –ª–µ–∫–∞—Ä—Å—Ç–≤...">
                <button type="submit" class="btn btn-outline-primary">–ù–∞–π—Ç–∏</button>
            </form>
        </div>
    </div>

    <!-- –°–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">üìÖ –õ–µ–∫–∞—Ä—Å—Ç–≤–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è - <span th:text="${#dates.format(today, 'dd.MM.yyyy')}"></span></h5>
                </div>
                <div class="card-body">
                    <div th:if="${todayPreparations.empty}" class="text-center text-muted">
                        –ù–∞ —Å–µ–≥–æ–¥–Ω—è –ª–µ–∫–∞—Ä—Å—Ç–≤ –Ω–µ—Ç
                    </div>
                    <div th:each="prep : ${todayPreparations}" class="card mb-3 today-card">
                        <div class="card-body">
                            <h5 th:text="${prep.name}" class="card-title"></h5>
                            <p class="card-text" th:text="${prep.description}"></p>
                            <p class="card-text">
                                <small class="text-muted">
                                    –ü–µ—Ä–∏–æ–¥: <span th:text="${#dates.format(prep.startDate, 'dd.MM.yyyy')}"></span> -
                                    <span th:text="${#dates.format(prep.endDate, 'dd.MM.yyyy')}"></span>
                                </small>
                            </p>
                            <div th:if="${not prep.schedules.empty}">
                                <h6>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏—ë–º–æ–≤:</h6>
                                <div th:each="schedule : ${prep.schedules}" class="d-flex justify-content-between align-items-center mb-2">
                                    <span th:text="${#temporals.format(schedule.time, 'HH:mm') + ' - ' + schedule.dosage}"></span>
                                    <div>
                                        <span th:if="${schedule.taken}" class="badge bg-success status-taken">‚úì –ü—Ä–∏–Ω—è—Ç–æ</span>
                                        <span th:unless="${schedule.taken}" class="badge bg-warning text-dark status-pending">‚è≥ –û–∂–∏–¥–∞–µ—Ç</span>
                                        <form th:action="@{/medications/schedules/{id}/mark-taken(id=${schedule.id})}" method="post" class="d-inline">
                                            <button th:unless="${schedule.taken}" type="submit" class="btn btn-sm btn-success ms-2">–û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–∏–Ω—è—Ç—ã–º</button>
                                        </form>
                                        <form th:action="@{/medications/schedules/{id}/mark-pending(id=${schedule.id})}" method="post" class="d-inline">
                                            <button th:if="${schedule.taken}" type="submit" class="btn btn-sm btn-secondary ms-2">–í–µ—Ä–Ω—É—Ç—å –≤ –æ–∂–∏–¥–∞–Ω–∏–µ</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <a th:href="@{/medications/{id}(id=${prep.id})}" class="btn btn-primary btn-sm">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ</h5>
                </div>
                <div class="card-body">
                    <form th:action="@{/medications}" th:object="${preparation}" method="post">
                        <div class="mb-3">
                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                            <input type="text" th:field="*{name}" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea th:field="*{description}" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                            <input type="date" th:field="*{startDate}" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                            <input type="date" th:field="*{endDate}" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- –í—Å–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">üìã –í—Å–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞</h5>
                </div>
                <div class="card-body">
                    <div th:if="${allPreparations.empty}" class="text-center text-muted">
                        –°–ø–∏—Å–æ–∫ –ª–µ–∫–∞—Ä—Å—Ç–≤ –ø—É—Å—Ç
                    </div>
                    <div th:each="prep : ${allPreparations}" class="card mb-3 medication-card">
                        <div class="card-body">
                            <h5 th:text="${prep.name}" class="card-title"></h5>
                            <p class="card-text" th:text="${prep.description}"></p>
                            <p class="card-text">
                                <small class="text-muted">
                                    –ü–µ—Ä–∏–æ–¥: <span th:text="${#dates.format(prep.startDate, 'dd.MM.yyyy')}"></span> -
                                    <span th:text="${#dates.format(prep.endDate, 'dd.MM.yyyy')}"></span>
                                    <span th:if="${prep.shouldBeTakenToday()}" class="badge bg-success ms-2">–°–µ–≥–æ–¥–Ω—è</span>
                                </small>
                            </p>
                            <a th:href="@{/medications/{id}(id=${prep.id})}" class="btn btn-outline-primary btn-sm">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                            <form th:action="@{/medications/{id}/delete(id=${prep.id})}" method="post" class="d-inline">
                                <button type="submit" class="btn btn-outline-danger btn-sm"
                                        onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ?')">–£–¥–∞–ª–∏—Ç—å</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>